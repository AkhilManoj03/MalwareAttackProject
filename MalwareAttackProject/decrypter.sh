#! /bin/bash

# creates the decryption file that will decrypt all the encrypted files
cat > decrypt.py << EOF
#!/usr/bin/env python3
import os
from cryptography.fernet import Fernet


files = []

for file in os.listdir():
    if file == "decrypt.py" or file == "decrypter.sh":
        continue
    if os.path.isfile(file):
        files.append(file)

print(files)
secretkey = b'7JXX6MEIa28_qDrjoNrQPp1BTI2Q5Yq_YAc9zm_H0RU='
for file in files:
    with open(file, "rb") as thefile:
        contents = thefile.read()
    contents_decrypted = Fernet(secretkey).decrypt(contents)
    with open(file, "wb") as thefile:
        thefile.write(contents_decrypted)


EOF

# deletes decrypt.py and decrypter.sh after they have been run 
pip install --upgrade pip
python3 -m pip install cryptography
python3 decrypt.py
rm decrypt.py 
rm decrypter.sh
